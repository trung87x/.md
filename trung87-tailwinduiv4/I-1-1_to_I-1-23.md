# üìÑ R-1: Tailwind UI Component ‚Äî Requirement chi ti·∫øt

---

## R-1-1. Kh·ªüi t·∫°o d·ª± √°n

·ª®ng d·ª•ng ph·∫£i ƒë∆∞·ª£c kh·ªüi t·∫°o b·∫±ng **Vite + vanilla JS**, s·∫µn s√†ng t√≠ch h·ª£p **Tailwind v4**.

---

## R-1-2. Chu·∫©n t√™n & ph√¢n lo·∫°i

M·ªói component ph·∫£i ƒë∆∞·ª£c g·∫Øn **category** (application-ui, ecommerce, faq, marketing, custom) v√† **slug duy nh·∫•t**.

---

## R-1-3. ƒê·ªãnh nghƒ©a meta.json

M·ªói component ph·∫£i c√≥ file **meta.json** ch·ª©a schema:  
`title, slug, category, tags, variants, deps, props`.

---

## R-1-4. Catalog builder

H·ªá th·ªëng ph·∫£i c√≥ c∆° ch·∫ø **qu√©t to√†n b·ªô meta.json** v√† gom th√†nh **catalog duy nh·∫•t** ph·ª•c v·ª• tra c·ª©u.

---

## R-1-5. Router (hash)

·ª®ng d·ª•ng ph·∫£i ƒëi·ªÅu h∆∞·ªõng b·∫±ng **hash route**, h·ªó tr·ª£ pattern:

- `#/c/:category`
- `#/c/:category/:slug`
- `#/search?q=...`

---

## R-1-6. AppShell

Giao di·ªán ch√≠nh ph·∫£i c√≥:

- **Header** (search)
- **Sidebar** (danh m·ª•c)
- **Main** (n·ªôi dung)

---

## R-1-7. Sidebar tree + counters

Sidebar ph·∫£i hi·ªÉn th·ªã **danh m·ª•c ƒë·ªông (t·ª´ catalog)** v√† **ƒë·∫øm s·ªë l∆∞·ª£ng component** m·ªói category.

---

## R-1-8. Search index

H·ªá th·ªëng ph·∫£i cho ph√©p **t√¨m ki·∫øm component** theo `title, slug, category, tags`.

---

## R-1-9. Component list view

Trang **category** ph·∫£i hi·ªÉn th·ªã danh s√°ch component d·∫°ng **card grid** v·ªõi th√¥ng tin c∆° b·∫£n.

---

## R-1-10. Viewer layout (tabs + actions)

Viewer ph·∫£i c√≥:

- Tabs: **Preview + Code (HTML, Alpine n·∫øu c√≥)**
- Actions: **Copy, Open, Dark toggle, Variant select**

---

## R-1-11. Sandbox renderer

Preview ph·∫£i ch·∫°y trong **iframe ƒë·ªôc l·∫≠p**, c√≥ **Tailwind v4** v√† **optional Alpine**.

---

## R-1-12. N·∫°p code raw

Code snippet HTML ph·∫£i ƒë∆∞·ª£c **n·∫°p d·∫°ng text raw** ƒë·ªÉ hi·ªÉn th·ªã trong tab code.

---

## R-1-13. H√†nh ƒë·ªông c∆° b·∫£n

Ph·∫£i h·ªó tr·ª£:

- **Copy** code ra clipboard
- **Open** snippet ·ªü c·ª≠a s·ªï m·ªõi
- **Dark/Light** toggle

---

## R-1-14. Variants & Props

Viewer ph·∫£i cho ph√©p:

- **Ch·ªçn variant**
- **ƒêi·ªÅu ch·ªânh props** (nh∆∞ size, rounded) n·∫øu meta c√≥ ƒë·ªãnh nghƒ©a

---

## R-1-15. Alpine support

N·∫øu component y√™u c·∫ßu **Alpine**, iframe ph·∫£i t·ª± ƒë·ªông ch√®n **script Alpine** ƒë·ªÉ ch·∫°y.

---

## R-1-16. Favorites & Recent

Ng∆∞·ªùi d√πng ph·∫£i c√≥ th·ªÉ:

- ƒê√°nh d·∫•u **Favorites**
- Xem danh s√°ch **Recent** (g·∫ßn ƒë√¢y)

---

## R-1-17. Custom components

Ph·∫£i h·ªó tr·ª£ th√™m **component t·ª± vi·∫øt (Custom)** theo c√πng schema meta.

---

## R-1-18. Guard b·∫£n quy·ªÅn

Snippet mua (Tailwind UI) ph·∫£i ƒë∆∞·ª£c gi·ªØ **private**, kh√¥ng push public repo.

---

## R-1-19. T·ªëi ∆∞u hi·ªáu nƒÉng

·ª®ng d·ª•ng ph·∫£i t·ªëi ∆∞u:

- **Debounce search**
- **Cache snippet**
- **Reuse iframe**

---

## R-1-20. Testing c∆° b·∫£n

C·∫ßn c√≥ **test t·ª± ƒë·ªông (Vitest)** ƒë·ªÉ ƒë·∫£m b·∫£o catalog v√† router ho·∫°t ƒë·ªông ·ªïn ƒë·ªãnh.

---

## R-1-21. Docs n·ªôi b·ªô

C·∫ßn c√≥:

- **README.md**: h∆∞·ªõng d·∫´n th√™m component m·ªõi
- **CONTRIBUTING.md**: quy ∆∞·ªõc slug, folder, variant; kh√¥ng push snippet mua

---

## R-1-22. Build & package

·ª®ng d·ª•ng ph·∫£i:

- Build ƒë∆∞·ª£c ra **static site** (`npm run build`)
- C√≥ th·ªÉ **export ph·∫ßn Custom + khung**

---

## R-1-23. Roadmap m·ªü r·ªông

·ª®ng d·ª•ng n√™n ph√°t tri·ªÉn th√™m:

- **Playground** ch·ªânh class
- **Screenshot generator**
- **CLI import**
- **Tagging n√¢ng cao**
- **Notes cho snippet**

---

# üìÑ I-1: Tailwind UI Component (Chi ti·∫øt t·ª´ I-1-1 ƒë·∫øn I-1-4)

---

## I-1-1. Kh·ªüi t·∫°o d·ª± √°n (Vite + vanilla)

### L·ªánh kh·ªüi t·∫°o

```bash
npm create vite@latest trung87-tailwinduiv4 -- --template vanilla
cd trung87-tailwinduiv4
npm i
```

### C·∫•u tr√∫c t·ªëi thi·ªÉu

```
/public/index.html
/src/app/main.js
/src/app/router.js
/src/core/catalog.js
/src/core/sandbox.js
/src/ui/AppShell.html
/src/ui/AppShell.js
/src/ui/Viewer.js
/src/components/.keep
/src/custom/.keep
/src/data/.keep
```

### /public/index.html

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TailwindUI v4 Explorer</title>
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css" />
  </head>
  <body class="min-h-dvh bg-zinc-50 text-zinc-900">
    <div id="app" class="min-h-dvh"></div>
    <script type="module" src="/src/app/main.js"></script>
  </body>
</html>
```

### /src/app/main.js

```js
import { mountAppShell } from "../ui/AppShell.js";
import { initRouter } from "./router.js";
import "./style.css";

(async function () {
  await mountAppShell(document.getElementById("app"));
  initRouter();
})();
```

### /src/app/router.js

```js
import { showCategory, showViewer, showSearch } from "../ui/Viewer.js";

export function initRouter() {
  window.addEventListener("hashchange", handle);
  handle();
}

function handle() {
  const h = location.hash.slice(1);
  if (h.startsWith("/c/")) {
    const parts = h.split("/");
    const category = parts[2];
    const slug = parts.slice(3).join("/");
    if (slug) showViewer(category, slug);
    else showCategory(category);
    return;
  }
  if (h.startsWith("/search")) {
    const q = new URLSearchParams(h.split("?")[1]).get("q") || "";
    showSearch(q);
    return;
  }
  location.hash = "/c/application-ui";
}
```

### /src/ui/AppShell.html

```html
<header class="border-b bg-white">
  <div class="max-full mx-auto flex h-14 items-center gap-3 px-12">
    <div class="font-semibold">TailwindUI v4 Explorer</div>
    <form id="searchForm" class="ml-auto">
      <input
        id="q"
        class="border rounded px-3 py-1"
        placeholder="T√¨m component..."
      />
    </form>
  </div>
</header>
<div class="max-full mx-auto grid grid-cols-12 gap-4 px-12 py-4">
  <aside id="sidebar" class="col-span-3 md:col-span-2"></aside>
  <main id="main" class="col-span-9 md:col-span-10"></main>
</div>
```

### /src/ui/AppShell.js

```js
import html from "./AppShell.html?raw";

export async function mountAppShell(host) {
  host.innerHTML = html;

  const form = host.querySelector("#searchForm");
  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const q = form.querySelector("#q").value || "";
    location.hash = `/search?q=${encodeURIComponent(q)}`;
  });

  host.querySelector("#sidebar").innerHTML = `
    <nav class="space-y-1 text-sm">
      <a class="block px-2 py-1 rounded hover:bg-zinc-100" href="#/c/application-ui">application-ui</a>
      <a class="block px-2 py-1 rounded hover:bg-zinc-100" href="#/c/ecommerce">ecommerce</a>
      <a class="block px-2 py-1 rounded hover:bg-zinc-100" href="#/c/faq">faq</a>
      <a class="block px-2 py-1 rounded hover:bg-zinc-100" href="#/c/marketing">marketing</a>
      <a class="block px-2 py-1 rounded hover:bg-zinc-100" href="#/c/custom">custom</a>
    </nav>
  `;
}
```

### /src/ui/Viewer.js (khung t·∫°m)

```js
export async function showCategory(category) {
  document.getElementById("main").innerHTML = `
    <h1 class="text-xl font-semibold mb-3">Category: ${category}</h1>
    <p class="text-zinc-600">Danh s√°ch component s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y sau I-1-4.</p>
  `;
}
export async function showViewer(category, slug) {
  document.getElementById("main").innerHTML = `
    <h1 class="text-xl font-semibold">Viewer</h1>
    <p>ƒêang ch·ªù catalog (I-1-4) ƒë·ªÉ n·∫°p: <code>${category}/${slug}</code></p>
  `;
}
export async function showSearch(q) {
  document.getElementById("main").innerHTML = `
    <h1 class="text-xl font-semibold mb-3">Search: "${q}"</h1>
    <p class="text-zinc-600">K·∫øt qu·∫£ s·∫Ω hi·ªÉn th·ªã sau I-1-8.</p>
  `;
}
```

---

## I-1-2. Chu·∫©n t√™n & ph√¢n lo·∫°i

**Category:** application-ui | ecommerce | faq | marketing | custom

**Slug:** v√≠ d·ª• `buttons/primary`, `forms/input`, `navigation/sidebar`.

V√≠ d·ª•:

- application-ui/buttons/primary
- application-ui/forms/input
- ecommerce/product/price-card
- faq/accordion/basic
- marketing/hero/with-cta

---

## I-1-3. Schema meta.json + v√≠ d·ª•

### Schema

```json
{
  "title": "Primary Button",
  "slug": "buttons/primary",
  "category": "application-ui",
  "tags": ["button", "cta"],
  "hasAlpine": false,
  "variants": [{ "id": "default", "label": "Default", "file": "default.html" }],
  "deps": { "alpine": false },
  "props": { "size": ["sm", "md", "lg"], "rounded": ["md", "xl"] }
}
```

### V√≠ d·ª• file

```
/src/components/application-ui/buttons/primary/
  meta.json
  default.html
```

**default.html**

```html
<button class="px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700">
  Primary
</button>
```

### Validator nh·ªè

```js
export function validateMeta(m) {
  const need = ["title", "slug", "category", "variants"];
  for (const k of need) if (!(k in m)) throw new Error(`meta thi·∫øu "${k}"`);
  if (!Array.isArray(m.variants) || m.variants.length === 0) {
    throw new Error("meta.variants ph·∫£i c√≥ √≠t nh·∫•t 1 ph·∫ßn t·ª≠");
  }
  return m;
}
```

---

## I-1-4. Catalog builder

### /src/core/catalog.js

```js
import { validateMeta } from "./validateMeta.js";

const metaFiles = import.meta.glob("/src/components/**/meta.json", {
  eager: true,
  import: "default",
});

export const htmlFiles = import.meta.glob("/src/components/**/**/*.html", {
  as: "raw",
});

export async function buildCatalog() {
  const list = [];
  for (const path in metaFiles) {
    const raw = metaFiles[path];
    const meta = validateMeta ? validateMeta(raw) : raw;

    meta.variants = meta.variants.map((v) => ({
      ...v,
      path: path.replace("meta.json", v.file),
    }));

    meta._key = `${meta.category}/${meta.slug}`;
    list.push(meta);
  }
  list.sort((a, b) => (a._key > b._key ? 1 : -1));
  return list;
}
```

### /src/core/sandbox.js

```js
import appCssUrl from "../app/style.css?url";

export async function renderInSandbox(
  iframe,
  html,
  { dark = false, alpine = false } = {}
) {
  const doc = iframe.contentDocument;
  doc.open();
  doc.write(`<!doctype html>
<html lang="en" class="${dark ? "dark" : ""}">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="${appCssUrl}"></link>
  ${alpine ? '<script defer src="https://unpkg.com/alpinejs"></script>' : ""}
  <style>
    html, body { height:auto; }
    body {
      margin: 0;
      background: ${dark ? "#09090b" : "#f4f4f5"};
      color: ${dark ? "#e4e4e7" : "#09090b"};
    }
  </style>
</head>
<body class="p-4">
${html}
<script>
(function(){
  // c·∫•u h√¨nh min/max theo nhu c·∫ßu
  const MIN = 10, MAX = 900;

  function measure() {
    const root = document.documentElement;
    const body = document.body;
    const h = Math.max(root.scrollHeight, body ? body.scrollHeight : 0);
    const clamped = Math.min(MAX, Math.max(MIN, h));
    // frameElement l√† ch√≠nh th·∫ª <iframe> ·ªü parent
    if (frameElement) frameElement.style.height = clamped + "px";
  }

  const ro = new ResizeObserver(() => requestAnimationFrame(measure));
  ro.observe(document.documentElement);
  if (document.body) ro.observe(document.body);

  addEventListener("load", measure, true);
  setTimeout(measure, 0);
})();
</script>
</body>
</html>`);
  doc.close();
}
```

### C·∫≠p nh·∫≠t Viewer (demo catalog)

```js
import { buildCatalog, htmlFiles } from "../core/catalog.js";
import { renderInSandbox } from "../core/sandbox.js";

let CATALOG = null;

export async function showCategory(category) {
  if (!CATALOG) CATALOG = await buildCatalog();
  const items = CATALOG.filter((m) => m.category === category);
  const main = document.getElementById("main");
  main.innerHTML = `
    <h1 class="text-xl font-semibold mb-3">Category: ${category}</h1>
    <ul class="space-y-2">
      ${items
        .map(
          (m) => `
        <li>
          <a class="text-blue-600 hover:underline"
             href="#/c/${m.category}/${m.slug}">${m.title}</a>
          <span class="text-xs text-zinc-500">(${m.variants.length} variant)</span>
        </li>`
        )
        .join("")}
    </ul>
  `;
}

export async function showViewer(category, slug) {
  if (!CATALOG) CATALOG = await buildCatalog();
  const meta = CATALOG.find((m) => m.category === category && m.slug === slug);
  const main = document.getElementById("main");
  if (!meta) {
    main.innerHTML = `<p>Kh√¥ng t√¨m th·∫•y meta.</p>`;
    return;
  }

  // --- UI ---
  main.innerHTML = `
    <h1 class="text-xl font-semibold mb-4">${meta.title}</h1>
    <div class="space-y-6">
      ${meta.variants
        .map(
          (v) => `
      <section class="border rounded overflow-hidden">
        <header class="flex items-center justify-between px-3 py-2 border-b">
          <div class="font-medium">${v.label}</div>
          <div class="flex items-center gap-2 text-sm">
            <!-- Segmented: Preview | Code -->
            <div class="inline-flex rounded border overflow-hidden" role="tablist">
              <button class="px-3 py-1.5" data-tab="${v.id}" data-to="preview">Preview</button>
              <button class="px-3 py-1.5 border-l" data-tab="${v.id}" data-to="code">Code</button>
            </div>
            <!-- Device widths -->
            <div class="inline-flex rounded border overflow-hidden">
              <button class="px-2 py-1.5" title="Mobile" data-w="${v.id}" data-size="480">üì±</button>
              <button class="px-2 py-1.5 border-l" title="Tablet" data-w="${v.id}" data-size="1024">üìü</button>
              <button class="px-2 py-1.5 border-l" title="Desktop" data-w="${v.id}" data-size="1280">üñ•Ô∏è</button>
              <button class="px-2 py-1.5 border-l" title="Full" data-w="${v.id}" data-size="full">‚Üî</button>
            </div>
            <!-- Dark -->
            <button class="px-2 py-1.5 rounded border" data-dark="${v.id}" title="Dark mode">üåô</button>
            <!-- Lang -->
            <select class="px-2 py-1.5 rounded border bg-white" data-lang="${v.id}">
              <option value="html" selected>HTML</option>
              <option value="react" disabled>React</option>
              <option value="vue" disabled>Vue</option>
            </select>
            <!-- Copy -->
            <button class="px-2 py-1.5 rounded border" data-copy="${v.id}" title="Copy code">üìã</button>
          </div>
        </header>

        <div class="p-3">
          <!-- v√πng cu·ªôn ngang -->
          <div id="scroll-${v.id}" class="overflow-x-auto">
            <!-- khung b·ªçc c√≥ width ƒë√∫ng b·∫±ng iframe ƒë·ªÉ cu·ªôn -->
            <div id="wrap-${v.id}" class="inline-block w-full px-4">
              <iframe id="pv-${v.id}" class="block w-full bg-white rounded shadow-sm"></iframe>
            </div>
          </div>

          <!-- Code -->
          <pre id="box-${v.id}" class="hidden bg-zinc-900 text-zinc-50 p-3 text-sm overflow-auto mt-3 rounded">
<code id="code-${v.id}">Loading‚Ä¶</code>
          </pre>
        </div>
      </section>
      `
        )
        .join("")}
    </div>
  `;

  // --- N·∫°p v√† g·∫Øn h√†nh vi cho t·ª´ng variant ---
  for (const v of meta.variants) {
    const html = await htmlFiles[v.path]();

    // Render preview m·∫∑c ƒë·ªãnh
    const iframe = document.getElementById(`pv-${v.id}`);
    let isDark = false;
    await renderInSandbox(iframe, html, {
      dark: isDark,
      alpine: meta.deps?.alpine,
    });

    // Hi·ªán code (escaped ƒë·ªÉ an to√†n)
    document.getElementById(`code-${v.id}`).textContent = html;

    // Tab switch
    const wrap = document.getElementById(`wrap-${v.id}`);
    const codeBox = document.getElementById(`box-${v.id}`);
    const tabBtns = [...document.querySelectorAll(`[data-tab="${v.id}"]`)];
    function switchTab(to) {
      const showPreview = to === "preview";
      wrap.classList.toggle("hidden", !showPreview);
      codeBox.classList.toggle("hidden", showPreview);
      tabBtns.forEach((b) =>
        b.classList.toggle("bg-zinc-100", b.dataset.to === to)
      );
    }
    tabBtns.forEach((b) => (b.onclick = () => switchTab(b.dataset.to)));
    switchTab("preview");

    // Device widths ‚Äî ƒë·ªïi width c·ªßa CH√çNH iframe ‚úÖ
    function applyWidth(size) {
      // ‚úÖ CHANGED
      if (size === "full") {
        iframe.style.width = "100%";
        wrap.style.maxWidth = "none";
        wrap.style.marginLeft = "";
        wrap.style.marginRight = "";
      } else {
        const px = String(size).endsWith("px") ? String(size) : `${size}px`;
        iframe.style.width = px; // ‚úÖ CHANGED
        wrap.style.maxWidth = px; // center cho g·ªçn
        wrap.style.marginLeft = "auto";
        wrap.style.marginRight = "auto";
      }
    }
    applyWidth("full");
    document.querySelectorAll(`[data-w="${v.id}"]`).forEach((b) => {
      b.onclick = () => applyWidth(b.dataset.size);
    });

    // Dark toggle
    document.querySelector(`[data-dark="${v.id}"]`).onclick = async () => {
      isDark = !isDark;
      await renderInSandbox(iframe, html, {
        dark: isDark,
        alpine: meta.deps?.alpine,
      });
    };

    // Copy
    document.querySelector(`[data-copy="${v.id}"]`).onclick = () =>
      navigator.clipboard.writeText(html);
  }
}

function escapeHtml(s) {
  return s.replace(
    /[&<>"']/g,
    (m) =>
      ({ "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#39;" }[
        m
      ])
  );
}

export async function showSearch(q) {
  document.getElementById("main").innerHTML = `
    <h1 class="text-xl font-semibold mb-3">Search: "${q}"</h1>
    <p class="text-zinc-600">K·∫øt qu·∫£ s·∫Ω hi·ªÉn th·ªã sau I-1-8.</p>
  `;
}
```

---

## ‚úÖ Sau b∆∞·ªõc n√†y, b·∫°n ƒë√£ c√≥:

- App khung + router + sidebar
- Schema meta.json
- Catalog builder ho·∫°t ƒë·ªông
- Th·∫•y component demo preview + code

---

## I-1-5. Router (hash) ·ªïn ƒë·ªãnh

**M·ª•c ti√™u:** B·ªï sung parse r√µ r√†ng, route fallback, v√† cho ph√©p `#/` ‚Üí redirect sang `/c/application-ui`.

**File:** `/src/app/router.js`

```js
import { showCategory, showViewer, showSearch } from "../ui/Viewer.js";

export function initRouter() {
  window.addEventListener("hashchange", handle);
  handle();
}

function handle() {
  const h = location.hash.slice(1);
  if (!h || h === "/") {
    location.hash = "/c/application-ui";
    return;
  }

  if (h.startsWith("/c/")) {
    const parts = h.split("/");
    const category = parts[2];
    const slug = parts.slice(3).join("/");
    if (slug) showViewer(category, slug);
    else showCategory(category);
    return;
  }

  if (h.startsWith("/search")) {
    const q = new URLSearchParams(h.split("?")[1]).get("q") || "";
    showSearch(q);
    return;
  }

  // fallback
  document.getElementById(
    "main"
  ).innerHTML = `<p class="text-red-600">404 - Route kh√¥ng t·ªìn t·∫°i</p>`;
}
```

---

## I-1-6. AppShell ho√†n ch·ªânh h∆°n

**M·ª•c ti√™u:** Thay sidebar hard-code b·∫±ng t·ª± sinh t·ª´ catalog. (Tu·ª≥ ch·ªçn: sau n√†y th√™m toggle dark/light.)

**File:** `/src/ui/AppShell.js`

```js
import html from "./AppShell.html?raw";
import { buildCatalog } from "../core/catalog.js";

export async function mountAppShell(host) {
  host.innerHTML = html;

  const form = host.querySelector("#searchForm");
  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const q = form.querySelector("#q").value || "";
    location.hash = `/search?q=${encodeURIComponent(q)}`;
  });

  // build sidebar t·ª´ catalog
  const sidebar = host.querySelector("#sidebar");
  const catalog = await buildCatalog();
  const categories = [...new Set(catalog.map((c) => c.category))];
  sidebar.innerHTML = categories
    .map(
      (c) =>
        `<a class="block px-2 py-1 rounded hover:bg-zinc-100" href="#/c/${c}">${c}</a>`
    )
    .join("");
}
```

> G·ª£i √Ω m·ªü r·ªông (t√πy ch·ªçn):
>
> - Th√™m n√∫t toggle **dark/light**: ƒë·∫∑t/ƒë·ªçc c·ªù trong `localStorage`, toggle `document.documentElement.classList.toggle("dark")`.

---

## I-1-7. Sidebar tree + counters

**M·ª•c ti√™u:** Hi·ªÉn th·ªã s·ªë component theo category (v√≠ d·ª• `application-ui (12)`). Chu·∫©n b·ªã cho **expand/collapse** trong t∆∞∆°ng lai.

**File:** `/src/ui/AppShell.js` (b·∫£n n√¢ng c·∫•p)

```js
import html from "./AppShell.html?raw";
import { buildCatalog } from "../core/catalog.js";

export async function mountAppShell(host) {
  host.innerHTML = html;

  const form = host.querySelector("#searchForm");
  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const q = form.querySelector("#q").value || "";
    location.hash = `/search?q=${encodeURIComponent(q)}`;
  });

  const sidebar = host.querySelector("#sidebar");
  const catalog = await buildCatalog();

  // ƒê·∫øm s·ªë component theo category
  const counts = {};
  for (const c of catalog) {
    counts[c.category] = (counts[c.category] || 0) + 1;
  }

  const categories = Object.keys(counts).sort();
  sidebar.innerHTML = categories
    .map(
      (c) =>
        `<a class="block px-2 py-1 rounded hover:bg-zinc-100" href="#/c/${c}">
       ${c} <span class="text-xs text-zinc-500">(${counts[c]})</span>
     </a>`
    )
    .join("");
}
```

---

## ‚úÖ K·∫øt qu·∫£ sau b∆∞·ªõc n√†y

- Router ƒëi·ªÅu h∆∞·ªõng ch·∫Øc ch·∫Øn, c√≥ **redirect** v√† **fallback 404**.
- Sidebar sinh t·ª± ƒë·ªông t·ª´ **catalog**, k√®m **s·ªë l∆∞·ª£ng component** m·ªói category.
- Kh√¥ng c√≤n c·∫ßn **hard‚Äëcode** category.
- S·∫µn s√†ng ƒë·ªÉ n√¢ng c·∫•p: **dark/light**, **expand/collapse tree**.

---

## I-1-8. Search index (nhanh, kh√¥ng th∆∞ vi·ªán)

Ch·ªâ m·ª•c theo **title, tags, slug, category**. T√°ch token b·∫±ng regex, l∆∞u map `<token> -> Set(componentKey)>`. Trang `/search?q=` tr·∫£ list k·∫øt qu·∫£.

**File:** `/src/core/search.js`

```js
let IDX = null,
  CATALOG = null;

const tokenize = (s) =>
  (s || "")
    .toLowerCase()
    .normalize("NFKD")
    .replace(/[\u0300-\u036f]/g, "")
    .match(/[a-z0-9\-]+/g) || [];

export async function ensureIndex(buildCatalog) {
  if (IDX) return { index: IDX, catalog: CATALOG };
  CATALOG = await buildCatalog();
  IDX = new Map();
  for (const m of CATALOG) {
    const toks = new Set([
      ...tokenize(m.title),
      ...(m.tags?.flatMap(tokenize) || []),
      ...tokenize(m.slug),
      ...tokenize(m.category),
    ]);
    for (const t of toks) {
      if (!IDX.has(t)) IDX.set(t, new Set());
      IDX.get(t).add(m._key);
    }
  }
  return { index: IDX, catalog: CATALOG };
}

export async function search(q, buildCatalog) {
  const { index, catalog } = await ensureIndex(buildCatalog);
  const tokens = tokenize(q);
  if (!tokens.length) return [];
  let result = null;
  for (const t of tokens) {
    const s = index.get(t) || new Set();
    result = result ? new Set([...result].filter((x) => s.has(x))) : new Set(s);
    if (!result.size) break;
  }
  const keys = [...(result || [])];
  return keys.map((k) => catalog.find((m) => m._key === k));
}
```

**T√≠ch h·ª£p UI:** `/src/ui/Viewer.js` (th√™m `showSearch`)

```js
import { buildCatalog } from "../core/catalog.js";
import { search } from "../core/search.js";

export async function showSearch(q) {
  const items = await search(q, buildCatalog);
  const main = document.getElementById("main");
  main.innerHTML = \`
    <h1 class="text-xl font-semibold mb-3">Search: "\${q}"</h1>
    <p class="text-sm text-zinc-500 mb-2">\${items.length} k·∫øt qu·∫£</p>
    <ul class="space-y-2">\${items.map(m => \`
      <li>
        <a class="text-blue-600 hover:underline" href="#/c/\${m.category}/\${m.slug}">
          \${m.title}
        </a>
        <span class="text-xs text-zinc-500">(\${m.category})</span>
      </li>\`).join("")}
    </ul>\`;
}
```

---

## I-1-9. Component list view (ƒë·∫πp + responsive)

Grid card hi·ªÉn th·ªã title, tags, variants, n√∫t ‚ÄúOpen‚Äù.

**File:** `/src/ui/Viewer.js` (thay `showCategory`)

```js
import { buildCatalog } from "../core/catalog.js";

export async function showCategory(category) {
  const C = await buildCatalog();
  const items = C.filter(x => x.category === category);
  const main = document.getElementById("main");
  main.innerHTML = \`
    <h1 class="text-xl font-semibold mb-3 capitalize">\${category}</h1>
    <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
    \${items.map(m => \`
      <article class="border rounded-lg p-3 bg-white">
        <h3 class="font-medium">\${m.title}</h3>
        <p class="text-xs text-zinc-500">\${m.tags?.join(", ") || ""}</p>
        <p class="text-xs text-zinc-500 mt-1">\${m.variants.length} variant</p>
        <div class="mt-3">
          <a class="inline-block text-sm px-3 py-1 border rounded hover:bg-zinc-50"
             href="#/c/\${m.category}/\${m.slug}">Open</a>
        </div>
      </article>\`).join("")}
    </div>\`;
}
```

---

## I-1-10. Viewer layout (tabs) + actions

Tabs: **Preview | HTML | (Alpine n·∫øu c√≥)**.  
Actions: **Copy, Open, Dark toggle, Variant select**.

**File:** `/src/ui/Viewer.js` (c·∫≠p nh·∫≠t `showViewer`)

```js
import { buildCatalog, htmlFiles } from "../core/catalog.js";
import { renderInSandbox } from "../core/sandbox.js";

export async function showViewer(category, slug) {
  const C = await buildCatalog();
  const meta = C.find(m => m.category === category && m.slug === slug);
  if (!meta) return document.getElementById("main").innerHTML = \`<p>Not found</p>\`;
  const current = meta.variants[0];

  const main = document.getElementById("main");
  main.innerHTML = \`
    <div class="flex items-center gap-3 mb-3">
      <h1 class="text-xl font-semibold">\${meta.title}</h1>
      <select id="variant" class="ml-auto border rounded px-2 py-1 text-sm">
        \${meta.variants.map(v => \`<option value="\${v.id}">\${v.label}</option>\`).join("")}
      </select>
      <button id="dark" class="border rounded px-2 py-1 text-sm">Dark</button>
      <button id="copy" class="border rounded px-2 py-1 text-sm">Copy</button>
      <button id="open" class="border rounded px-2 py-1 text-sm">Open</button>
    </div>

    <div class="border rounded overflow-hidden">
      <nav class="border-b flex">
        <button data-tab="preview" class="px-3 py-2">Preview</button>
        <button data-tab="html" class="px-3 py-2">HTML</button>
        \${meta.hasAlpine ? \`<button data-tab="alpine" class="px-3 py-2">Alpine</button>\` : ""}
      </nav>
      <div id="tab-preview"><iframe id="pv" class="w-full h-[480px]"></iframe></div>
      <pre id="tab-html" class="hidden p-3 text-sm overflow-auto"><code></code></pre>
      \${meta.hasAlpine ? \`<pre id="tab-alpine" class="hidden p-3 text-sm overflow-auto"><code></code></pre>\` : ""}
    </div>\`;

  let dark = false, variantId = current.id;

  async function loadAndRender() {
    const v = meta.variants.find(x => x.id === variantId) || meta.variants[0];
    const html = await htmlFiles[v.path]();
    main.querySelector("#tab-html code").textContent = html;
    await renderInSandbox(main.querySelector("#pv"), html, { dark, alpine: meta.deps?.alpine });
    return html;
  }

  let lastHtml = await loadAndRender();

  // handlers
  main.querySelectorAll("[data-tab]").forEach(btn => {
    btn.onclick = () => switchTab(main, btn.dataset.tab);
  });
  main.querySelector("#variant").onchange = async e => {
    variantId = e.target.value; lastHtml = await loadAndRender();
  };
  main.querySelector("#dark").onclick = async () => {
    dark = !dark; lastHtml = await loadAndRender();
  };
  main.querySelector("#copy").onclick = async () => {
    await navigator.clipboard.writeText(lastHtml);
  };
  main.querySelector("#open").onclick = () => {
    const w = window.open("", "_blank");
    w.document.write(lastHtml);
    w.document.close();
  };
}

function switchTab(root, name) {
  ["preview","html","alpine"].forEach(id=>{
    const el = root.querySelector(\`#tab-\${id}\`); if (!el) return;
    el.classList.toggle("hidden", id !== name);
  });
}
```

---

## I-1-11. Sandbox renderer (ƒë√£ c√≥)

ƒê√£ tri·ªÉn khai tr∆∞·ªõc ƒë√≥ (iframe + Tailwind CDN + Alpine optional). N·∫øu build Tailwind local ‚Üí thay `<script>` b·∫±ng:

```html
<link rel="stylesheet" href="/tailwind.css" />
```

---

## I-1-12. N·∫°p code raw (ƒë√£ c√≥)

ƒêang d√πng `import.meta.glob(..., { as:'raw' })` ‚Äî **·ªïn**.

---

## I-1-13. H√†nh ƒë·ªông c∆° b·∫£n (ƒë√£ c√≥)

**Copy / Open / Dark** ƒë√£ wiring trong `showViewer`.

---

## I-1-14. Variants & Props

- **Variants**: ƒë√£ c√≥ `<select>`.
- **Props**: panel nh·ªè th√™m class; √°p v√†o HTML b·∫±ng c√°ch b·ªçc th√™m `<div class="TW-PROPS ...">` ho·∫∑c re-render chu·ªói.

**File:** `/src/ui/PropsPanel.js` (√Ω t∆∞·ªüng g·ªçn)

```js
export function renderPropsPanel(host, meta, onChange) {
  const props = meta.props || {};
  host.innerHTML = Object.entries(props).map(([k, vals]) => \`
    <label class="text-sm block mt-2">\${k}</label>
    <select data-prop="\${k}" class="border rounded px-2 py-1 text-sm">
      \${vals.map(v=>\`<option>\${v}</option>\`).join("")}
    </select>\`).join("");
  host.querySelectorAll("select[data-prop]").forEach(sel=>{
    sel.onchange = () => {
      const chosen = {};
      host.querySelectorAll("select[data-prop]").forEach(s=>chosen[s.dataset.prop]=s.value);
      onChange(chosen);
    };
  });
}
```

**√Åp d·ª•ng props khi render:** trong `showViewer()`

```js
import { renderPropsPanel } from "./PropsPanel.js";
// ...
main.insertAdjacentHTML("beforeend", \`<div id="props" class="mt-3"></div>\`);
const propsHost = main.querySelector("#props");
renderPropsPanel(propsHost, meta, async chosen => {
  // v√≠ d·ª•: th√™m rounded/size class v√†o wrapper
  const html = await htmlFiles[meta.variants.find(x=>x.id===variantId).path]();
  const wrapped = \`<div class="\${Object.values(chosen).join(" ")}">\${html}</div>\`;
  main.querySelector("#tab-html code").textContent = wrapped;
  await renderInSandbox(main.querySelector("#pv"), wrapped, { dark, alpine: meta.deps?.alpine });
});
```

---

## I-1-15. Alpine support (ƒë√£ c√≥)

`deps.alpine: true` ‚Üí ch√®n script Alpine v√†o iframe. Snippet Alpine c·ªßa Tailwind UI ch·∫°y ·ªïn nh·ªù isolation.

---

## I-1-16. Favorites & Recent

**File:** `/src/core/storage.js`

```js
const LS = {
  favs: "twui:favs",
  recent: "twui:recent",
};
export const getFavs = () => JSON.parse(localStorage.getItem(LS.favs) || "[]");
export const toggleFav = (key) => {
  const a = new Set(getFavs());
  a.has(key) ? a.delete(key) : a.add(key);
  localStorage.setItem(LS.favs, JSON.stringify([...a]));
  return [...a];
};
export const pushRecent = (key) => {
  const max = 20;
  const arr = JSON.parse(localStorage.getItem(LS.recent) || "[]");
  const out = [key, ...arr.filter((x) => x !== key)].slice(0, max);
  localStorage.setItem(LS.recent, JSON.stringify(out));
  return out;
};
```

G·ªçi `pushRecent(meta._key)` trong `showViewer`. ·ªû Sidebar c√≥ th·ªÉ th√™m m·ª•c **Favorites** (ƒë·ªçc `getFavs()`).

---

## I-1-17. Khu ‚ÄúCustom components‚Äù

T·∫°o th∆∞ m·ª•c `/src/custom/...` v·ªõi c√πng schema. B·ªï sung glob trong `catalog.js` ƒë·ªÉ qu√©t **components** + **custom**.

**File:** `/src/core/catalog.js` (m·ªü r·ªông)

```js
const metaFiles = {
  ...import.meta.glob("/src/components/**/meta.json", {
    eager: true,
    import: "default",
  }),
  ...import.meta.glob("/src/custom/**/meta.json", {
    eager: true,
    import: "default",
  }),
};
export const htmlFiles = {
  ...import.meta.glob("/src/components/**/**/*.html", { as: "raw" }),
  ...import.meta.glob("/src/custom/**/**/*.html", { as: "raw" }),
};
```

---

## I-1-18. Guard b·∫£n quy·ªÅn

Th√™m v√†o `.gitignore`:

```
/src/components/**/   # n·∫øu ƒë√¢y l√† n∆°i ƒë·ªÉ snippet mua
!/src/custom/**       # gi·ªØ custom
```

Ho·∫∑c ƒë·∫∑t snippets mua **ngo√†i repo** (config ƒë∆∞·ªùng d·∫´n ri√™ng b·∫±ng env) ‚Üí nguy√™n t·∫Øc: **kh√¥ng public**.

---

## I-1-19. T·ªëi ∆∞u hi·ªáu nƒÉng

- Debounce search input **200ms**.
- Cache `lastHtml` theo `meta._key + variant + props`.
- Reuse c√πng m·ªôt iframe: ch·ªâ `doc.write` l·∫°i.
- V·ªõi list l·ªõn: d√πng **virtual list** (sau).

**Debounce helper**

```js
export const debounce = (fn, ms = 200) => {
  let t;
  return (...args) => {
    clearTimeout(t);
    t = setTimeout(() => fn(...args), ms);
  };
};
```

---

## I-1-20. Testing c∆° b·∫£n (Vitest)

```bash
npm i -D vitest
```

**File:** `/src/tests/catalog.test.js`

```js
import { describe, it, expect } from "vitest";
import { buildCatalog } from "../core/catalog.js";

describe("catalog", () => {
  it("builds without error and has keys", async () => {
    const c = await buildCatalog();
    expect(Array.isArray(c)).toBe(true);
    expect(c[0]).toHaveProperty("_key");
    expect(c[0]).toHaveProperty("variants");
  });
});
```

**Th√™m script** trong `package.json`:

```json
{
  "scripts": { "test": "vitest" }
}
```

---

## I-1-21. Docs n·ªôi b·ªô

- **README.md**: c√°ch th√™m component (checklist ng·∫Øn).
- **CONTRIBUTING.md**: quy ∆∞·ªõc slug, folder, t√™n variant; **kh√¥ng push snippet mua**.

**Checklist th√™m m·ªõi**

1. T·∫°o folder `category/.../slug/`
2. Vi·∫øt `meta.json` theo schema
3. Th√™m `default.html` (v√† c√°c variant)
4. Ch·∫°y dev, ki·ªÉm tra viewer
5. (Optional) th√™m tags, props

---

## I-1-22. Build & package

Vite build static:

```bash
npm run build
npm run preview
```

(Tu·ª≥ ch·ªçn) **N√∫t Export zip**: gom `custom` + khung app ‚Üí zip (client-side d√πng JSZip ho·∫∑c script Node ngo√†i app).

---

## I-1-23. Roadmap m·ªü r·ªông

- **Playground**: ch·ªânh class Tailwind tr·ª±c ti·∫øp trong textarea ‚Üí apply v√†o preview (two‚Äëpane editor).
- **Screenshot generator**: d√πng `html-to-image` trong iframe ‚Üí PNG.
- **CLI import**: script Node qu√©t th∆∞ m·ª•c ngo√†i, sinh `meta.json` t·ª± ƒë·ªông (d√≤ file `*.html`).
- **Tagging n√¢ng cao**: filter nhi·ªÅu tag; sort theo ‚Äúm·ªõi th√™m‚Äù, ‚Äúhay d√πng‚Äù (d·ª±a Favorites/Recent).
- **Snippet Notes**: √¥ ghi ch√∫ c·ªßa b·∫°n cho t·ª´ng snippet (l∆∞u `localStorage`).

---

**H·∫øt l·ªô tr√¨nh I‚Äë1.** B·∫°n c·∫ßn m√¨nh ‚Äúcode ho√°‚Äù ph·∫ßn n√†o tr∆∞·ªõc (v√≠ d·ª•: **Props panel** ho√†n ch·ªânh hay **Playground**) th√¨ n√≥i m√¨nh l√†m ti·∫øp nh√©.
